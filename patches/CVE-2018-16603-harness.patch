From 39c2e171eb48e907473d9f0057ca6e17b2573399 Mon Sep 17 00:00:00 2001
From: Paschal Amusuo <amusuopaschal@gmail.com>
Date: Wed, 16 Oct 2024 18:49:48 -0400
Subject: [PATCH] Changes to recreate and expose CVEs

---
 .../ProcessReceivedTCPPacket_harness.c                    | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/test/cbmc/proofs/parsing/ProcessReceivedTCPPacket/ProcessReceivedTCPPacket_harness.c b/test/cbmc/proofs/parsing/ProcessReceivedTCPPacket/ProcessReceivedTCPPacket_harness.c
index 00f6e80..949d12a 100644
--- a/test/cbmc/proofs/parsing/ProcessReceivedTCPPacket/ProcessReceivedTCPPacket_harness.c
+++ b/test/cbmc/proofs/parsing/ProcessReceivedTCPPacket/ProcessReceivedTCPPacket_harness.c
@@ -103,7 +103,13 @@ void harness()
     /* To avoid asserting on the network buffer being NULL. */
     __CPROVER_assume( pxNetworkBuffer != NULL );
 
-    pxNetworkBuffer->pucEthernetBuffer = safeMalloc( sizeof( TCPPacket_t ) );
+    // ICSE-NIER: Made the buffer size non-deterministic to recreate CVE-2018-16603
+    // pxNetworkBuffer->pucEthernetBuffer = safeMalloc( sizeof( TCPPacket_t ) );
+
+    uint8_t data_size;
+    __CPROVER_assume(data_size > 54);
+    pxNetworkBuffer->pucEthernetBuffer = safeMalloc( data_size );
+    pxNetworkBuffer->xDataLength = data_size;
 
     /* To avoid asserting on the ethernet buffer being NULL. */
     __CPROVER_assume( pxNetworkBuffer->pucEthernetBuffer != NULL );
-- 
2.25.1

