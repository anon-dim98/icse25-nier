From 39c2e171eb48e907473d9f0057ca6e17b2573399 Mon Sep 17 00:00:00 2001
From: Paschal Amusuo <amusuopaschal@gmail.com>
Date: Wed, 16 Oct 2024 18:49:48 -0400
Subject: [PATCH] Changes to recreate and expose CVEs

---
 .../ProcessICMPPacket/ProcessICMPPacket_harness.c    | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/test/cbmc/proofs/ICMP/ProcessICMPPacket/ProcessICMPPacket_harness.c b/test/cbmc/proofs/ICMP/ProcessICMPPacket/ProcessICMPPacket_harness.c
index 185cbee..288ac5e 100644
--- a/test/cbmc/proofs/ICMP/ProcessICMPPacket/ProcessICMPPacket_harness.c
+++ b/test/cbmc/proofs/ICMP/ProcessICMPPacket/ProcessICMPPacket_harness.c
@@ -58,13 +58,21 @@ void harness()
 {
     NetworkBufferDescriptor_t xNetworkBuffer;
 
+    // ICSE-NIER: Updated this harness to expose CVE-2018-16527
+    uint8_t data_size;
+
+    __CPROVER_assume( data_size < 1000 );
+
     /* Allocate a ICMP packet */
-    ICMPPacket_t * const pxICMPPacket = safeMalloc( sizeof( ICMPPacket_t ) );
+    // ICMPPacket_t * const pxICMPPacket = safeMalloc( sizeof( ICMPPacket_t ) );
+    ICMPPacket_t * const pxICMPPacket = safeMalloc( data_size );
 
     __CPROVER_assume( pxICMPPacket != NULL );
 
-    xNetworkBuffer.xDataLength = sizeof( ICMPPacket_t );
+    // xNetworkBuffer.xDataLength = sizeof( ICMPPacket_t );
+    xNetworkBuffer.xDataLength = data_size;
     xNetworkBuffer.pucEthernetBuffer = pxICMPPacket;
 
     ProcessICMPPacket( &xNetworkBuffer );
 }
+
-- 
2.25.1

