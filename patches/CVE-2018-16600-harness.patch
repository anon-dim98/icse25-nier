From 39c2e171eb48e907473d9f0057ca6e17b2573399 Mon Sep 17 00:00:00 2001
From: Paschal Amusuo <amusuopaschal@gmail.com>
Date: Wed, 16 Oct 2024 18:49:48 -0400
Subject: [PATCH] Changes to recreate and expose CVEs

---
 .../ARP/ARPProcessPacket/ARPProcessPacket_harness.c    | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

diff --git a/test/cbmc/proofs/ARP/ARPProcessPacket/ARPProcessPacket_harness.c b/test/cbmc/proofs/ARP/ARPProcessPacket/ARPProcessPacket_harness.c
index 539f02d..31cd8fd 100644
--- a/test/cbmc/proofs/ARP/ARPProcessPacket/ARPProcessPacket_harness.c
+++ b/test/cbmc/proofs/ARP/ARPProcessPacket/ARPProcessPacket_harness.c
@@ -70,16 +70,18 @@ void harness()
      * is at least allocated to sizeof(ARPPacket_t) size but eventually an even larger buffer.
      * This is not checked inside eARPProcessPacket.
      */
-    uint8_t ucBUFFER_SIZE;
-
-    void * xBuffer = malloc( ucBUFFER_SIZE + sizeof( ARPPacket_t ) );
+    uint8_t ucBUFFER_SIZE; 
 
+    // ICSE-NIER: Updated the buffer size so it can contain truncated ARP header, reproducing CVE-2018-16600
+    // void * xBuffer = malloc( ucBUFFER_SIZE + sizeof( ARPPacket_t ) );
+    void * xBuffer = malloc( ucBUFFER_SIZE + sizeof( EthernetHeader_t ) );
+    
     __CPROVER_assume( xBuffer != NULL );
 
     NetworkBufferDescriptor_t xNetworkBuffer2;
 
     xNetworkBuffer2.pucEthernetBuffer = xBuffer;
-    xNetworkBuffer2.xDataLength = ucBUFFER_SIZE + sizeof( ARPPacket_t );
+    xNetworkBuffer2.xDataLength = ucBUFFER_SIZE + sizeof( EthernetHeader_t );
 
     /*
      * This proof assumes one end point is present.
-- 
2.25.1

